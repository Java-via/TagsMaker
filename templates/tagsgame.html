<!DOCTYPE html>
<!-- saved from url=(0037)http://v3.bootcss.com/examples/cover/ -->
<html lang="zh-CN">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../static/ic.jpg">

    <title>贴标签-游戏</title>

    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../static/css/cover.css" rel="stylesheet">
</head>

<body>
<div class="site-wrapper">
    <div class="site-wrapper-inner">
        <div class="cover-container">
            <div class="masthead clearfix">
                <div class="inner">
                    <h3 class="masthead-brand">贴标签-游戏</h3>
                    <nav>
                        <ul class="nav masthead-nav">
                            <li class="active"><a href="http://v3.bootcss.com/examples/cover/#"></a></li>
                            <li><a href="http://v3.bootcss.com/examples/cover/#"></a></li>
                            <li><a href="http://v3.bootcss.com/examples/cover/#"></a></li>
                        </ul>
                    </nav>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-2">
                    <img id="app_img" src="#">图标
                </div>

                <div class="col-lg-5 col-lg-offset-0.5">
                    <div id="app_name" style="font-size: large"><a href="#" id="app_url">游戏名称</a></div>
                    <label id="app_pkgname" style="display: none"></label>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-2">
                    游戏关键词
                </div>
                <div class="col-lg-5" id="app_tags">
                    关键词1 关键词2 关键词3
                </div>
            </div>
            <h4>&nbsp;</h4>
            <div class="row">
                <div class="col-lg-2">游戏描述
                </div>
                <div class="col-md-10" id="app_desc">
                    游戏详情描述
                </div>
            </div>

            <h2>&nbsp;</h2>
            <div id="tags" class="row">
            </div>
            <h2>&nbsp;</h2>
            <div class="row">
                <div class="col-lg-4">
                    <button type="button" id="app_top" class="btn btn-info">上一个</button>
                </div>
                <!--<div class="col-lg-2"></div>-->
                <div class="col-lg-4">
                    <button type="button" id="group_next" class="btn btn-info" disabled="disabled">下一组</button>
                </div>
                <div class="col-lg-4">
                    <button type="button" id="app_next" class="btn btn-info">下一个</button>
                </div>
            </div>
            <div class="mastfoot">
                <div class="inner">
                    <p> by Jessie.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="../static/js/jquery.min.js"></script>
<script src="../static/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../static/js/ie10-viewport-bug-workaround.js"></script>

<script defer="defer" type="text/javascript">
    var index = 0;
    var apps;
    var tags;
    window.onload = function () {

        $.ajax({
            url: "/gameinfo",
            dataType: "json",
            async: false,
            type: "GET",
            beforeSend: function () {

            },
            success: function (data) {
                if (data.msg.toString() == "no data") {
                    alert(data.msg.toString());
                }else {
                    tags = data.tags;
                    for(key in tags) {
                        if (key.indexOf("key") >= 0) {
                            var tag_div = "<div class='col-lg-12' id='" + key + "';></div>";
                            $('#tags').append(tag_div);
                            var i = 0;
                            for(n_key in tags[key]) {
                                var tag_label = "<label id='" + "label_"+ key + i + "'>" + tags[key][n_key] + "&nbsp</label>";
                                $("#" + key).append(tag_label);
                                $("#label_"+n_key+i).attr("class", "label");
                                $("#label_"+n_key+i).attr("style", "font-size: 15px");
                                $("#label_"+n_key+i).attr("id", "label"+key);
                                i = i + 1;
                                var j = 0;
                                // tags[key][n_key]是label显示的汉字（如：性别偏好）
                                for(v_key in tags[n_key]) {
                                    // n_key是radio的name值，v_key是radio的value值，tags[n_key][v_key]是每个radio显示的汉字
                                    var tag_input = "<input id='" + "input_" + n_key + j + "'>" + tags[n_key][v_key] + "&nbsp";
                                    $("#" + key).append(tag_input);
                                    $("#input_"+n_key+j).attr("type", "radio");
                                    $("#input_"+n_key+j).attr("name", n_key);
                                    $("#input_"+n_key+j).attr("value", v_key);
                                    j = j + 1;
                                }
                            }
                        }
                    }

                    apps = data.apps;
                    var app = apps[index];
                    $('#app_pkgname').text(app[0]);
                    $('#app_name').text(app[1]);
                    $('#app_tags').text(app[3]);
                    $('#app_desc').text(app[2]);
                    $('#app_url').attr("href ", app[5]);
                    $('#app_img').attr("img", "http://pp.myapp.com/ma_icon/0/icon_10627528_18151862_1415654543/96");
                    index = index + 1;
                }
            },
            complete: function () {

            },
            error: function (err) {
                console.log(err)
            }
        });
    }
</script>

<script defer="defer" type="text/javascript">

    $("#app_next").click(function () {
        var data;
        data = [];
        for(key in tags) {
            if (key.indexOf("key") >= 0) {
                for(n_key in tags[key]) {
                    // tags[key][n_key]是label显示的汉字（如：性别偏好）
                    if($("input[name='"+ n_key +"']:checked").length == 0) {
                        alert("还未填写完整，不能提交");
                        return;
                    }
                    data.push({key: n_key, value : $("input[name='"+ n_key +"']:checked").val()});
                    for(v_key in tags[n_key]) {
                        // n_key是radio的name值，v_key是radio的value值，tags[n_key][v_key]是每个radio显示的汉字
                    }
                }
            }
        }
        console.log(data);

        var _ajax = $.ajax({
            url : "/gametags",
            dataType : "json",
//                async : false,
            data : function() {
                data.push({pkgname: $("#app_pkgname").text()});
                return data;
            },
            type : "POST",
            beforeSend: function () {
//                if ($("input[name='sexual']:checked").length == 0
//                        | $("input[name='age']:checked").length == 0
//                        | $("input[name='age']:checked").length == 0
//                        | $("input[name='degree']:checked").length == 0) {
//                    alert("还未填写完整，不能提交");
//                    _ajax.abort();
//                }
            },
            success: function (data) {
                if(data.msg.toString() != "success") {
                    alert(data.msg.toString());
                }
                var app = apps[index];
                $('#app_pkgname').text(app[0]);
                $('#app_name').text(app[1]);
                $('#app_tags').text(app[3]);
                $('#app_desc').text(app[2]);
                $('#app_url').attr("href ", app[5]);
                $('#app_img').attr("img", "http://pp.myapp.com/ma_icon/0/icon_10627528_18151862_1415654543/96");

                index = index + 1;
                if (index == 10) {
                    $('#app_next').attr("disabled", "disabled");
                    $('#group_next').removeAttr("disabled");
                }

                $("input[name='sexual']:checked").prop("checked",false);
                $("input[name='age']:checked").prop("checked",false);
                $("input[name='marital']:checked").prop("checked",false);
                $("input[name='degree']:checked").prop("checked",false);
            },
            complete: function () {

            },
            error: function (err) {
                console.log(err)
            }
        });
    })
</script>

<script defer="defer" type="text/javascript">
    $('#group_next').click(function () {
        var _ajax = $.ajax( {
            url : "/moregame",
            dataType : "json",
            data : {
                pkgname : $("#app_pkgname").text(),
                sexual : $("input[name='sexual']:checked").val(),
                age : $("input[name='age']:checked").val(),
                marital : $("input[name='marital']:checked").val(),
                degree : $("input[name='degree']:checked").val(),
                index : index
            },
            type : "GET",
            beforeSend : function () {
                if ($("input[name='sexual']:checked").length == 0
                        | $("input[name='age']:checked").length == 0
                        | $("input[name='age']:checked").length == 0
                        | $("input[name='degree']:checked").length == 0) {
                    alert("还未填写完整，不能提交");
                    _ajax.abort();
                }
            },
            success : function (data) {
                index = 0;
                apps = data.apps;
                var app = apps[index];
                $('#app_pkgname').text(app[0]);
                $('#app_name').text(app[1]);
                $('#app_tags').text(app[3]);
                $('#app_desc').text(app[2]);
                $('#app_url').attr("href ", app[5]);
                $('#app_img').attr("img", "http://pp.myapp.com/ma_icon/0/icon_10627528_18151862_1415654543/96");

                index = index + 1;

                $("input[name='sexual']:checked").prop("checked",false);
                $("input[name='age']:checked").prop("checked",false);
                $("input[name='marital']:checked").prop("checked",false);
                $("input[name='degree']:checked").prop("checked",false);

                $('#app_next').removeAttr("disabled");
                $('#group_next').attr("disabled", "disabled");
            },
            complete : function () {

            },
            error : function () {

            }
        });
    })

</script>

</body></html>